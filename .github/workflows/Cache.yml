name: 'Test Caching'

on: [ push, pull_request ]

jobs:
    CacheWriteRestore:
        name: 'Cache something'
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout
                uses: actions/checkout@v2

            -   name: Current dir
                id: current
                run: |
                    echo "::set-output name=dir::$(pwd)"
                    echo "::set-output name=timestamp::$(date +"%s")"

            -   name: Cache Test
                uses: actions/cache@v2
                with:
                    path: ${{ steps.current.outputs.dir }}/foo/bar
                    key: ${{ runner.os }}-test-${{ steps.current.outputs.timestamp }}
                    restore-keys: |
                        ${{ runner.os }}-test-

            -   name: Write something
                run: |
                    ./cache.sh ${{ steps.current.outputs.dir }} ${{ steps.current.outputs.timestamp }}
